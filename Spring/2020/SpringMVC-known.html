<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    SpringMVC -- 必知必会 |  Sunny SongHui
  </title>
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Sunny SongHui" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    <main class="content">
      <section class="outer">
  <article id="post-SpringMVC-必知必会" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  SpringMVC -- 必知必会
</h1>
  

    </header>
    

    
    <div class="article-meta" style="align:center">
      <a href="/Spring/2020/SpringMVC-known.html" class="article-date">
  <time datetime="2020-01-18T08:10:43.000Z" itemprop="datePublished">2020-01-18</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/source/categories/Spring/">Spring</a>
  </div>

      
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp; 阅读次数:&nbsp;&nbsp;<span id="/Spring/2020/SpringMVC-known.html" class="pageViews">0</span>次
    
       <!-- 开始添加字数统计-->
        
          <div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <span class="post-count">6.4k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">29分</span>
      </span>
    </span>
</div>
          
        <!-- 添加完成 -->
    </div>
    

    
    
    <div class="tocbot"></div>





    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>​    SpringMVC基于模型–视图–控制器（Model-View-Controller，MVC）模式实现，属于SpringFrameWork的后续产品，已经融合在SpringWebFlow里面。它通过一套注解，让一个简单的Java类成为处理请求的控制器，而无需实现任何接口。同时它还支持RESTful编程风格的请求。SpringMVC是基于方法设计的，相比基于类设计的Struts2要稍微快一些。</p>
<a id="more"></a>

<h1 id="1-使用步骤"><a href="#1-使用步骤" class="headerlink" title="1. 使用步骤"></a>1. 使用步骤</h1><h5 id="第一步：导入jar包或Maven坐标"><a href="#第一步：导入jar包或Maven坐标" class="headerlink" title="第一步：导入jar包或Maven坐标"></a>第一步：导入jar包或Maven坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里导入spring-webmvc即可，会自动导入它依赖的其他jar包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第二步：修改并配置web-xml文件"><a href="#第二步：修改并配置web-xml文件" class="headerlink" title="第二步：修改并配置web.xml文件"></a>第二步：修改并配置web.xml文件</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改配置文件头约束为如下：（可到tomcat的web.xml中复制 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 1.配置核心控制器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispathcerServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置核心控制器的初始化参数,指定spring的配置文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:webApplicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- servlet初始化时机:服务器启动第一个加载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 2.配置映射路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispathcerServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- / 代表默认,用其可使用spring的REST风格的url --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 3.配置编码过滤器：解决post中文乱码问题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 设置编码方式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第三步：创建SpringMVC的配置文件"><a href="#第三步：创建SpringMVC的配置文件" class="headerlink" title="第三步：创建SpringMVC的配置文件"></a>第三步：创建SpringMVC的配置文件</h5><h6 id="webApplicationContext-xml"><a href="#webApplicationContext-xml" class="headerlink" title="webApplicationContext.xml"></a>webApplicationContext.xml</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.指定要扫描的包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"cn.dintalk"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2.开启mvc的注解驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3.配置解析器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"viewResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第四步：编写控制器（POJO-★★★"><a href="#第四步：编写控制器（POJO-★★★" class="headerlink" title="第四步：编写控制器（POJO)   ★★★"></a>第四步：编写控制器（POJO)   ★★★</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>) <span class="comment">//适合模块化开发(不加也可以)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">   <span class="comment">//1. 根据url地址进行url映射(handlerMapping)</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我的第一个处理器执行了.."</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="第五步：编写页面-★★★"><a href="#第五步：编写页面-★★★" class="headerlink" title="第五步：编写页面  ★★★"></a>第五步：编写页面  ★★★</h5><p>我们在页面中的链接如 …/user/hello便会访问到该方法</p>
<h1 id="2-URL映射"><a href="#2-URL映射" class="headerlink" title="2. URL映射"></a>2. URL映射</h1><p>​    url映射的规则，主要在添加@RequestMapping注解时指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 指定单个url地址映射(handlerMapping)</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//2. 指定多个url地址映射，但需保证不能和其他方法有重复的。</span></span><br><span class="line"><span class="comment">//思考一下为什么。</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(&#123;<span class="string">"/hello2"</span>,<span class="string">"hello1"</span>&#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//3. 根据请求方式进行映射</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/hello3"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello3</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//若当前处理器添加了模块映射：如/user，那么该方法会拦截到所有以POST方式</span></span><br><span class="line"><span class="comment">//请求到该处理器（请求路径以/user结尾，即未定位到指定方法）的请求</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//4. 根据请求参数进行映射</span></span><br><span class="line"><span class="comment">//params指定后，若不传参则会报错</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/hello5"</span>,params = &#123;<span class="string">"name"</span>,<span class="string">"password"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello5</span><span class="params">(String name,String password)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//5. 根据请求消息头进行映射</span></span><br><span class="line"><span class="comment">//不携带cookie消息头就会报错</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/hello6"</span>,headers = &#123;<span class="string">"cookie"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello6</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line"><span class="comment">//6. 根据请求的正文mime类型进行映射</span></span><br><span class="line"><span class="comment">//只有post请求才会有正文</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/hello7"</span>,</span><br><span class="line">    method = RequestMethod.POST,consumes = <span class="string">"multipart/form-data"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello7</span><span class="params">()</span></span>&#123;</span><br></pre></td></tr></table></figure>

<h1 id="3-请求参数的封装"><a href="#3-请求参数的封装" class="headerlink" title="3. 请求参数的封装"></a>3. 请求参数的封装</h1><h2 id="3-1-简单类型的封装"><a href="#3-1-简单类型的封装" class="headerlink" title="3.1 简单类型的封装"></a>3.1 简单类型的封装</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法,springmvc会自动进行数据类型转换，转换失败则报错</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/param"</span>,params =&#123;<span class="string">"name"</span>,<span class="string">"age"</span>&#125; )</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param</span><span class="params">(String name, Integer age)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;a href="$&#123;pageContext.request.contextPath&#125;/param?name=song&amp;age=21"&gt;简单参数的封装&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-数组的封装"><a href="#3-2-数组的封装" class="headerlink" title="3.2 数组的封装"></a>3.2 数组的封装</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/param1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param1</span><span class="params">(String[] myAr)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;form  action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/param1"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr"</span> value=<span class="string">"song"</span>&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr"</span> value=<span class="string">"hui"</span>&gt;</span><br><span class="line">    &lt;%-- hui1会覆盖掉hui --%&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr[1]"</span> value=<span class="string">"hui1"</span>&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr"</span> value=<span class="string">"慧"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"封装数组myArr"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">//页面传参数时，后边指定角标的会将前面的覆盖掉</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-POJO的封装"><a href="#3-3-POJO的封装" class="headerlink" title="3.3 POJO的封装"></a>3.3 POJO的封装</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/param2"</span>,params =&#123;<span class="string">"name"</span>,<span class="string">"age"</span>&#125; )</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param2</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;a href="$&#123;pageContext.request.contextPath&#125;/param2?name=song&amp;age=21"&gt;POJO的封装&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-封装POJO关联的POJO"><a href="#3-4-封装POJO关联的POJO" class="headerlink" title="3.4 封装POJO关联的POJO"></a>3.4 封装POJO关联的POJO</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/param3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param3</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;form  action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/param3"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    name:&lt;input name=<span class="string">"name"</span> value=<span class="string">"song"</span>/&gt;</span><br><span class="line">    name:&lt;input name=<span class="string">"password"</span> value=<span class="string">"hui"</span>/&gt;</span><br><span class="line">    address:&lt;input name=<span class="string">"address.province"</span> value=<span class="string">"bj"</span>&gt;</span><br><span class="line">    address:&lt;input name=<span class="string">"address.city"</span> value=<span class="string">"zjk"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"封装pojo关联的pojo"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">//封装user中关联的address</span></span><br></pre></td></tr></table></figure>

<h2 id="3-5-封装POJO关联的数组"><a href="#3-5-封装POJO关联的数组" class="headerlink" title="3.5 封装POJO关联的数组"></a>3.5 封装POJO关联的数组</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法 </span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/param4"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param4</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;form  action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/param4"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    name:&lt;input name=<span class="string">"name"</span> value=<span class="string">"song"</span>/&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr"</span> value=<span class="string">"s"</span>&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr"</span> value=<span class="string">"hui"</span>&gt;</span><br><span class="line">    &lt;%-- hui1会覆盖掉hui --%&gt;</span><br><span class="line">    arr:&lt;input name=<span class="string">"myArr[1]"</span> value=<span class="string">"hui1"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"封装pojo关联的arr"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">//页面传参数时，后边指定角标的会将前面的覆盖掉</span></span><br></pre></td></tr></table></figure>

<h2 id="3-6-封装POJO关联的List"><a href="#3-6-封装POJO关联的List" class="headerlink" title="3.6 封装POJO关联的List"></a>3.6 封装POJO关联的List</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(path = <span class="string">"/param5"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param5</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;form  action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/param5"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    name:&lt;input name=<span class="string">"name"</span> value=<span class="string">"song"</span>/&gt;</span><br><span class="line">    list:&lt;input name=<span class="string">"myList"</span> value=<span class="string">"1"</span>&gt;</span><br><span class="line">    list:&lt;input name=<span class="string">"myList"</span> value=<span class="string">"hui"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"封装pojo关联的list"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-7-封装POJO关联的Map"><a href="#3-7-封装POJO关联的Map" class="headerlink" title="3.7 封装POJO关联的Map"></a>3.7 封装POJO关联的Map</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理器的方法</span></span><br><span class="line"> <span class="meta">@RequestMapping</span>(path = <span class="string">"/param6"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">param6</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line"><span class="comment">//jsp页面</span></span><br><span class="line">&lt;form  action=<span class="string">"$&#123;pageContext.request.contextPath&#125;/param6"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">    name:&lt;input name=<span class="string">"name"</span> value=<span class="string">"song"</span>/&gt;</span><br><span class="line">    map:&lt;input name=<span class="string">"myMap['s']"</span> value=<span class="string">"song"</span>&gt;</span><br><span class="line">    map:&lt;input name=<span class="string">"myMap[s1]"</span> value=<span class="string">"hui"</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">"submit"</span> value=<span class="string">"封装pojo关联的map"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"><span class="comment">//页面传参数指定map的key可用单引号也可不用</span></span><br></pre></td></tr></table></figure>

<h1 id="4-请求的转发和重定向"><a href="#4-请求的转发和重定向" class="headerlink" title="4. 请求的转发和重定向"></a>4. 请求的转发和重定向</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求转发</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"我的第一个处理器执行了.."</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello"</span>;  <span class="comment">// 服务器默认用的是请求转发</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"我的第一个处理器执行了.."</span>);</span><br><span class="line">    <span class="comment">// 自己转发的话，必须用实际视图地址</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"forward:/WEB-INF/pages/hello.jsp"</span>;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//请求重定向</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">hello2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"我的第一个处理器执行了.."</span>);</span><br><span class="line">    <span class="comment">// 重定向</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:http://www.baidu.com"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-SpringMVC下静态资源的访问"><a href="#5-SpringMVC下静态资源的访问" class="headerlink" title="5. SpringMVC下静态资源的访问"></a>5. SpringMVC下静态资源的访问</h1><p>​    我们在Spring MVC框架中为了是URL更符合RESTful风格，通常在web.xml中会配置Spring框架servlet 的 url 拦截为  “/“  ,也就是拦截所有资源的url请求，这样一来，所有的资源包括， js  | css |  图片  |  所有静态资源都将经过框架的servlet拦截 。而又没有对应的处理器，因此会找不到资源（404）。因此我们要对静态资源放行：</p>
<h5 id="第一种方法：激活web应用服务器（如Tomcat）的defaultServlet来处理静态文件"><a href="#第一种方法：激活web应用服务器（如Tomcat）的defaultServlet来处理静态文件" class="headerlink" title="第一种方法：激活web应用服务器（如Tomcat）的defaultServlet来处理静态文件"></a>第一种方法：激活web应用服务器（如Tomcat）的defaultServlet来处理静态文件</h5><h6 id="web-xml中加入以下配置"><a href="#web-xml中加入以下配置" class="headerlink" title="web.xml中加入以下配置"></a>web.xml中加入以下配置</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jpg<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.js<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.css<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong> 要配置多个，每种文件配置一个,要写在DispatcherServlet的前面,让defaultServlet先拦截，这样就不会进入Spring了，可能性能是最好的。</p>
<h5 id="第二种方法：使用Spring3-0-4以后版本提供的-lt-mvc-resources-gt"><a href="#第二种方法：使用Spring3-0-4以后版本提供的-lt-mvc-resources-gt" class="headerlink" title="第二种方法：使用Spring3.0.4以后版本提供的  &lt;mvc:resources /&gt;"></a>第二种方法：使用Spring3.0.4以后版本提供的  &lt;mvc:resources /&gt;</h5><h6 id="webApplicationContext-xml中加入以下配置"><a href="#webApplicationContext-xml中加入以下配置" class="headerlink" title="webApplicationContext.xml中加入以下配置"></a>webApplicationContext.xml中加入以下配置</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/static/**"</span> <span class="attr">location</span>=<span class="string">"/static/"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 不加下面这句话可能会报错 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong> location的值要配到最后一个/ ,如果这里只写到 /static 还是放行不了的。</p>
<h5 id="第三种方法：使用-lt-mvc-default-servlet-handler-gt"><a href="#第三种方法：使用-lt-mvc-default-servlet-handler-gt" class="headerlink" title="第三种方法：使用 &lt;mvc:default-servlet-handler/ &gt;"></a>第三种方法：使用 &lt;mvc:default-servlet-handler/ &gt;</h5><h6 id="webApplicationContext-xml中加入以下配置-1"><a href="#webApplicationContext-xml中加入以下配置-1" class="headerlink" title="webApplicationContext.xml中加入以下配置"></a>webApplicationContext.xml中加入以下配置</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:<span class="keyword">default</span>-servlet-handler <span class="keyword">default</span>-servlet-name=<span class="string">"default"</span>/&gt;</span><br></pre></td></tr></table></figure>

<h5 id="Tips：如果用后两种方法的话-加载一个静态资源是却要经过框架servlet的层层pattern，会有不必要的性能开销。-但对于一些比较重要的静态文件，我们可以将其放在WEB-INF目录下保护起来（该目录下不可直接访问-，但我们可以在服务端应用-请求转发-。"><a href="#Tips：如果用后两种方法的话-加载一个静态资源是却要经过框架servlet的层层pattern，会有不必要的性能开销。-但对于一些比较重要的静态文件，我们可以将其放在WEB-INF目录下保护起来（该目录下不可直接访问-，但我们可以在服务端应用-请求转发-。" class="headerlink" title="Tips：如果用后两种方法的话 加载一个静态资源是却要经过框架servlet的层层pattern，会有不必要的性能开销。 但对于一些比较重要的静态文件，我们可以将其放在WEB-INF目录下保护起来（该目录下不可直接访问 )，但我们可以在服务端应用(请求转发)。"></a><strong>Tips：如果用后两种方法的话</strong> 加载一个静态资源是却要经过框架servlet的层层pattern，会有不必要的性能开销。 但对于一些比较重要的静态文件，我们可以将其放在WEB-INF目录下保护起来（该目录下不可直接访问 )，但我们可以在服务端应用(请求转发)。</h5><h1 id="6-常用注解、异步交互和Restful风格的url"><a href="#6-常用注解、异步交互和Restful风格的url" class="headerlink" title="6. 常用注解、异步交互和Restful风格的url"></a>6. 常用注解、异步交互和Restful风格的url</h1><h2 id="6-1-常用注解"><a href="#6-1-常用注解" class="headerlink" title="6.1 常用注解"></a>6.1 常用注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. @RequestParam:可处理请求参数名和处理器方法参数名不一致的情况</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"demo1"</span>)</span><br><span class="line"><span class="comment">//RequestParam默认required=true,指必须提供,否则报错!将username参数赋值给name</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo1</span><span class="params">(@RequestParam(value = <span class="string">"username"</span>,required = <span class="keyword">false</span>)</span>String name)</span>&#123;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//2. @RequestHeader:用指定消息头为处理器参数赋值</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"demo2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo2</span><span class="params">(@RequestHeader(<span class="string">"accept-encoding"</span>)</span>String encode)</span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//3. @CookieValue:获取cookie的值给处理器参数赋值</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"demo3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo3</span><span class="params">(@CookieValue(<span class="string">"JSESSIONID"</span>)</span>String JsessionId)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. @RequestBody:获取请求消息正文,注意只有post请求才有正文</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"demo4"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo4</span><span class="params">(@RequestBody String Content)</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5. @ModelAttribute:用在参数上，获取指定数据给参数赋值（无对应数据会报错）</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"demo5"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo5</span><span class="params">(@ModelAttribute(<span class="string">"user1"</span>)</span> User user1)</span>&#123;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//6. @ModelAttribute:用在方法上，会在控制器任意方法执行前执行</span></span><br><span class="line">	<span class="comment">//会把方法的返回值以指定名称存到域对象中。无返回值可通过隐式对象存数据</span></span><br><span class="line"><span class="meta">@ModelAttribute</span>(<span class="string">"user"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">createUser</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//7. @SessionAttributes:用在类定义上,将存放在model中对应的数据暂存到HttpSession 中。</span></span><br><span class="line">    <span class="comment">//会将model中所有类型为 User的属性添加到会话中。</span></span><br><span class="line"><span class="meta">@SessionAttributes</span>(types=User<span class="class">.<span class="keyword">class</span>)  </span></span><br><span class="line"><span class="class">    //会将<span class="title">model</span>中属性名为<span class="title">user1</span>和<span class="title">user2</span>的属性添加到会话中。</span></span><br><span class="line"><span class="class">@<span class="title">SessionAttributes</span>(<span class="title">value</span></span>=&#123;“user1”, “user2”&#125;) </span><br><span class="line">    <span class="comment">//会将model中所有类型为 User和Dept的属性添加到会话中。</span></span><br><span class="line"><span class="meta">@SessionAttributes</span>(types=&#123;User<span class="class">.<span class="keyword">class</span>, <span class="title">Address</span>.<span class="title">class</span>&#125;) </span></span><br><span class="line"><span class="class">    //会将<span class="title">model</span>中属性名为<span class="title">user1</span>和<span class="title">user2</span>以及类型为<span class="title">Dept</span>的属性添加到会话中。</span></span><br><span class="line"><span class="class">@<span class="title">SessionAttributes</span>(<span class="title">value</span></span>=&#123;“user1”,“user2”&#125;,types=&#123;Address<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class">//需要注意的是,<span class="title">value</span>和<span class="title">types</span>之间是取并集的关系</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">//8. @ResponseBody:将方法返回的对象，通过 HttpMessageConverter接口转换为指定格式的</span><br><span class="line">	<span class="comment">//数据如：json,xml 等，通过 Response 响应给客户端</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo8"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span>  <span class="comment">// 也可加到返回值前面，即User前面：public @ResponseBody User ...</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">demo8</span><span class="params">()</span></span>&#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//9. @PathVariable:绑定url中占位符如请求url中/delete/&#123;id&#125;，这个&#123;id&#125;就是url占位符。</span></span><br><span class="line">    <span class="comment">//将其赋给处理器参数，结合method=...,可实现rest风格的url</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user/&#123;id&#125;"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">find</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer uid)</span>&#123;</span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong>    @ModelAttribute用在参数上是从请求域中获取指定数据赋给参数，用在方法上是每一次访问该处理器的任意方法前都会执行该方法。可将所修饰的方法返回值以指定名称存入请求域中。</p>
<h2 id="6-2-异步交互"><a href="#6-2-异步交互" class="headerlink" title="6.2 异步交互"></a>6.2 异步交互</h2><p>​    使用SpringMVC如何完成ajax的异步交互呢？很简单，我们主要使用它的两个注解来实现:</p>
<h5 id="导入jackson的jar包或Maven坐标"><a href="#导入jackson的jar包或Maven坐标" class="headerlink" title="导入jackson的jar包或Maven坐标"></a>导入jackson的jar包或Maven坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 该包依赖的其他包会自动导入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-1-RequestBody接受异步请求"><a href="#2-1-RequestBody接受异步请求" class="headerlink" title="2.1@RequestBody接受异步请求"></a>2.1@RequestBody接受异步请求</h5><h6 id="处理器方法"><a href="#处理器方法" class="headerlink" title="处理器方法"></a>处理器方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo1</span><span class="params">(@RequestBody String content)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">    <span class="comment">//使用jackson解析json数据封装到pojo中</span></span><br><span class="line">    User user = objectMapper.readValue(content, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    System.out.println(<span class="string">"异步请求到了"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="异步请求页面"><a href="#异步请求页面" class="headerlink" title="异步请求页面"></a>异步请求页面</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   $(<span class="string">"#b1"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       $.ajax(&#123;</span><br><span class="line">           type: <span class="string">"POST"</span>,</span><br><span class="line">           url: <span class="string">"$&#123;pageContext.request.contextPath&#125;/json/demo1"</span>,</span><br><span class="line">           dataType: <span class="string">"json"</span>,</span><br><span class="line">           contentType: <span class="string">"application/json"</span>,</span><br><span class="line">           data: <span class="string">'&#123;"name":"song","password":"hui"&#125;'</span></span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>Tips</strong>: 如果不加入contentType:”application/json”会解析失败，因为加入它才会发送json格式的数据。</p>
<h5 id="2-2-ResponseBody返回Json数据"><a href="#2-2-ResponseBody返回Json数据" class="headerlink" title="2.2@ResponseBody返回Json数据"></a>2.2@ResponseBody返回Json数据</h5><h6 id="处理器方法-1"><a href="#处理器方法-1" class="headerlink" title="处理器方法"></a>处理器方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo2"</span>)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">"da"</span>);</span><br><span class="line">    user.setUid(<span class="number">22</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="异步请求页面-1"><a href="#异步请求页面-1" class="headerlink" title="异步请求页面"></a>异步请求页面</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#b2"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">"POST"</span>,</span><br><span class="line">            url: <span class="string">"$&#123;pageContext.request.contextPath&#125;/json/demo2"</span>,</span><br><span class="line">            data: <span class="string">'&#123;"name":"song","password":"hui"&#125;'</span>,</span><br><span class="line">            dataType: <span class="string">"json"</span>,</span><br><span class="line">            contentType: <span class="string">"application/json"</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                alert(data.uid);</span><br><span class="line">                alert(data.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="6-3-Restful风格的url"><a href="#6-3-Restful风格的url" class="headerlink" title="6.3 .Restful风格的url"></a>6.3 .Restful风格的url</h2><h3 id="6-3-1-restful的状态转化特性"><a href="#6-3-1-restful的状态转化特性" class="headerlink" title="6.3.1 restful的状态转化特性"></a>6.3.1 restful的状态转化特性</h3><p>​    HTTP 协议，是一个无状态协议，即所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生 “状态转化 ”（ State Transfer）。而这种转化是建立在表现层之上的，所以就是  “表现层状态转化 ”。具体说，就是  HTTP 协议里面，四个表示操作方式的动词： GET、 POST、 PUT、DELETE。它们分别对应四种基本操作： GET 用来获取资源， POST 用来新建资源， PUT 用来更新资源， DELETE 用来删除资源。</p>
<p><strong>restful  的示例：</strong><br>/account/1 HTTP  GET     ：       得到 id = 1 的 account<br>/account/1 HTTP  DELETE    ：     删除 id = 1 的 account<br>/account/1 HTTP  PUT        ：      更新 id = 1 的 account<br>/account HTTP  POST        ：       新增 account</p>
<h3 id="6-3-2-基于HiddenHttpMethodFilter使用-PathVariable注解构建rest风格的url"><a href="#6-3-2-基于HiddenHttpMethodFilter使用-PathVariable注解构建rest风格的url" class="headerlink" title="6.3.2 基于HiddenHttpMethodFilter使用@PathVariable注解构建rest风格的url"></a>6.3.2 基于HiddenHttpMethodFilter使用@PathVariable注解构建rest风格的url</h3><p>​    由于浏览器 form 表单只支持 GET 与 POST 请求，而 DELETE、PUT 等 method 并不支持，Spring3.0 添加了一个过滤器，可以将浏览器请求改为指定的请求方式，发送给我们的控制器方法，使得支持 GET、POST、PUT与 DELETE 请求。</p>
<h6 id="第一步：web-xml中配置过滤器"><a href="#第一步：web-xml中配置过滤器" class="headerlink" title="第一步：web.xml中配置过滤器"></a>第一步：web.xml中配置过滤器</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置过滤器将表单不支持的请求方式转化(支持restful风格) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="第二步：表单书写"><a href="#第二步：表单书写" class="headerlink" title="第二步：表单书写"></a>第二步：表单书写</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 对于不支持的请求方式,get，post之外的：form表单的method要指定为post</span></span><br><span class="line"><span class="comment">	并且要添加隐藏域。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/user"</span>&gt;</span></span><br><span class="line">    username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"admin"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"注册"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/user/1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"PUT"</span>&gt;</span></span><br><span class="line">    username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"admin1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"修改"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/user/1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"查询"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/user/1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"_method"</span> <span class="attr">value</span>=<span class="string">"DELETE"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"删除"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="第三步：处理器方法"><a href="#第三步：处理器方法" class="headerlink" title="第三步：处理器方法"></a>第三步：处理器方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user"</span>,method = RequestMethod.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">regist</span><span class="params">(User user)</span></span>&#123;<span class="keyword">return</span> <span class="string">"success"</span>;&#125;</span><br><span class="line"><span class="comment">//&#123;id&#125;参数的占位符</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user/&#123;id&#125;"</span>,method = RequestMethod.PUT)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">edit</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer uid, User user)</span>&#123;<span class="keyword">return</span> <span class="string">"success"</span>;&#125;</span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user/&#123;id&#125;"</span>,method = RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">find</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer uid)</span>&#123;<span class="keyword">return</span> <span class="string">"success"</span>;&#125;</span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/user1&#123;id&#125;"</span>,method = RequestMethod.DELETE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer uid)</span>&#123;<span class="keyword">return</span> <span class="string">"success"</span>;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="7-原始servletAPI、隐式对象和处理器返回值"><a href="#7-原始servletAPI、隐式对象和处理器返回值" class="headerlink" title="7. 原始servletAPI、隐式对象和处理器返回值"></a>7. 原始servletAPI、隐式对象和处理器返回值</h1><h2 id="7-1-原始servletAPI"><a href="#7-1-原始servletAPI" class="headerlink" title="7.1 原始servletAPI"></a>7.1 原始servletAPI</h2><p>​    要使用原始的servletAPI，我们在处理器方法中直接定义参数即可，框架会为我们传入对象。</p>
<h5 id="第一步：导入servlet的jar包或Maven坐标"><a href="#第一步：导入servlet的jar包或Maven坐标" class="headerlink" title="第一步：导入servlet的jar包或Maven坐标"></a>第一步：导入servlet的jar包或Maven坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第二步：处理器方法定义参数"><a href="#第二步：处理器方法定义参数" class="headerlink" title="第二步：处理器方法定义参数"></a>第二步：处理器方法定义参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo1</span><span class="params">(HttpServletRequest req, HttpServletResponse res)</span></span>&#123;</span><br><span class="line">    System.out.println(req+<span class="string">"==="</span>+res);</span><br></pre></td></tr></table></figure>

<h2 id="7-2-隐式对象"><a href="#7-2-隐式对象" class="headerlink" title="7.2 隐式对象"></a>7.2 隐式对象</h2><p>​    SpringMVC为我们提供好了默认的隐式对象，我们直接使用即可。使用Model,ModelMap和Map可以封装数据到模型对象中（request域级别）。同使用servletAPI一样，我们在处理器方法上定义参数即可使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Model对象</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo2</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line"> 	User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">"user2"</span>);</span><br><span class="line">    model.addAttribute(<span class="string">"user"</span>,user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ModelMap对象    </span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo3</span><span class="params">(ModelMap model)</span></span>&#123;</span><br><span class="line">	User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">"user3"</span>);</span><br><span class="line">    model.addAttribute(<span class="string">"user"</span>,user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;   </span><br><span class="line"><span class="comment">//Map对象</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo4"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo4</span><span class="params">(Map model)</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">"user4"</span>);</span><br><span class="line">    model.put(<span class="string">"user"</span>,user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong> 当然，我们也可以在处理器方法内部直接通过new创建其对象来使用。</p>
<h2 id="7-3-处理器返回值"><a href="#7-3-处理器返回值" class="headerlink" title="7.3 处理器返回值"></a>7.3 处理器返回值</h2><p>​    controller方法的返回值有三种：String、void、ModelAndView。</p>
<h3 id="7-3-1-String"><a href="#7-3-1-String" class="headerlink" title="7.3.1 String"></a>7.3.1 String</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回字符串指定逻辑视图名称，通过视图解析器解析为</span></span><br><span class="line"><span class="comment">// 真实视图地址。</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/demo1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-2-void"><a href="#7-3-2-void" class="headerlink" title="7.3.2 void"></a>7.3.2 void</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法无返回值，我们可以用servletAPI完成转发、重定向、响应。</span></span><br><span class="line"><span class="comment">// 转发</span></span><br><span class="line">request.getRequestDispatcher(<span class="string">"1.jsp"</span>).forward(request,response);</span><br><span class="line"><span class="comment">//重定向:这里重定向到了当前处理器的demo1方法</span></span><br><span class="line">response.sendRedirect(<span class="string">"demo1"</span>)</span><br><span class="line"><span class="comment">//直接响应：如json数据</span></span><br><span class="line">response.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">response.setContentType(<span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">response.getWriter().write(<span class="string">"我是json串"</span>);</span><br></pre></td></tr></table></figure>

<h3 id="7-3-3-ModelAndView"><a href="#7-3-3-ModelAndView" class="headerlink" title="7.3.3 ModelAndView"></a>7.3.3 ModelAndView</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping</span>(<span class="string">"/demo3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">demo3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">"haha"</span>);</span><br><span class="line">    ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    modelAndView.setViewName(<span class="string">"success"</span>);<span class="comment">//指定视图</span></span><br><span class="line">    modelAndView.addObject(<span class="string">"user"</span>,user);<span class="comment">//存放数据</span></span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="8-自定义类型转化器、拦截器和异常"><a href="#8-自定义类型转化器、拦截器和异常" class="headerlink" title="8. 自定义类型转化器、拦截器和异常"></a>8. 自定义类型转化器、拦截器和异常</h1><h2 id="8-1-自定义类型转换器"><a href="#8-1-自定义类型转换器" class="headerlink" title="8.1 自定义类型转换器"></a>8.1 自定义类型转换器</h2><p>​    SpringMVC内置简单类型转换器，所以我们在进行参数封装时SpringMVC会根据类型为我们进行自动转换。开发中，我们可根据需求自定义类型转化器，通过配置加入到SpringMVC的转换器列表中即可。比如我们常常需要将用户输入的日期字符串转换成日期类型的，即String –&gt;java.util.Date的转换。</p>
<h5 id="第一步：自定义类实现Converter-lt-S-T-gt-接口"><a href="#第一步：自定义类实现Converter-lt-S-T-gt-接口" class="headerlink" title="第一步：自定义类实现Converter&lt;S, T&gt;接口"></a>第一步：自定义类实现Converter&lt;S, T&gt;接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义类实现了org.springframework.core.convert.converter.Converter 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateLocalConvertor</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String pattern = <span class="string">"yyyy-MM-dd"</span>;</span><br><span class="line">	<span class="comment">//定义默认日期格式，并提供set方法使其可在配置文件中配置</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPattern</span><span class="params">(String pattern)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pattern = pattern;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//实现接口的转换方法：Source --&gt;Target</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(s)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(pattern);</span><br><span class="line">                Date date = simpleDateFormat.parse(s);</span><br><span class="line">                <span class="keyword">return</span> date;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"您输入的日期格式必须符合"</span>+pattern+<span class="string">"格式"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="第二步：注册自定义类型转换器到SpringMVC中"><a href="#第二步：注册自定义类型转换器到SpringMVC中" class="headerlink" title="第二步：注册自定义类型转换器到SpringMVC中"></a>第二步：注册自定义类型转换器到SpringMVC中</h5><h6 id="webApplicationContext-xml-1"><a href="#webApplicationContext-xml-1" class="headerlink" title="webApplicationContext.xml"></a>webApplicationContext.xml</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置类型转换器工厂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"converterService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.</span></span></span><br><span class="line"><span class="tag"><span class="string">                                   ConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.相当于调用了set方法,给工厂注入新的类型转换器  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 若将来有多个自定义的类型转化器,可以用array标签包裹多个bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.dintalk.convertor.DateLocalConvertor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引用自定义类型转化器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"converterService"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第三步：使用"><a href="#第三步：使用" class="headerlink" title="第三步：使用"></a>第三步：使用</h5><p>​    如此，我们在前端页面输入日期字符串后，处理器方法在进行封装时会用到我们自定义的类型转换器。否则没有日期类型转换器的话，而又有日期类型的数据封装的话会报400错误。</p>
<h2 id="8-2-自定义拦截器"><a href="#8-2-自定义拦截器" class="headerlink" title="8.2 自定义拦截器"></a>8.2 自定义拦截器</h2><p>​    SpringMVC的处理器拦截器类似于Servlet中的过滤器Filter，用于对处理器进行预处理和后处理。但又有区别：</p>
<ul>
<li>过滤器：是servlet中的规范，任何java web工程都可使用。</li>
<li>拦截器：是SpringMVC框架的，使用了SpringMVC的工程才能用。</li>
<li>过滤器：配置了url-pattern为 /*后，可拦截所有的资源访问。</li>
<li>拦截器：只拦截访问的控制器的方法，不拦截jsp、html、img等。</li>
</ul>
<p>我们要自定义拦截器，就必须实现接口：HandlerInterceptor。</p>
<h5 id="第一步：编写普通类实现HandlerInterceptor接口"><a href="#第一步：编写普通类实现HandlerInterceptor接口" class="headerlink" title="第一步：编写普通类实现HandlerInterceptor接口"></a>第一步：编写普通类实现HandlerInterceptor接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span>    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"到达处理器前的方法执行了"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">// 返回true这放行,否则拦截</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"处理器方法执行之后执行的方法执行了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"页面完成响应之前的方法执行了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="第二步：在webApplicationContext-xml中配置拦截器"><a href="#第二步：在webApplicationContext-xml中配置拦截器" class="headerlink" title="第二步：在webApplicationContext.xml中配置拦截器"></a>第二步：在webApplicationContext.xml中配置拦截器</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 拦截/inter开头的访问路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/inter/**"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.dintalk.web.interceptor.MyInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 拦截/user开头的访问路径 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/user/**"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 排除/user/login的访问路径(不进行拦截) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">"/user/login"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.dintalk.web.interceptor.CheckUserInterceptor"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong> 自定义拦截器一般实现第一个方法,即在请求到达处理器前进行拦截作相应处理以决定是否放行;多个处理器的执行顺序按照其配置的上下顺序。</p>
<h2 id="8-3-自定义异常"><a href="#8-3-自定义异常" class="headerlink" title="8.3 自定义异常"></a>8.3 自定义异常</h2><h3 id="8-3-1-异常处理思路"><a href="#8-3-1-异常处理思路" class="headerlink" title="8.3.1 异常处理思路"></a>8.3.1 异常处理思路</h3><p>​    系统中异常包括两类：预期异常和运行时异常 RuntimeException，前者通过捕获异常从而获取异常信息，后者主要通过规范代码开发、测试通过手段减少运行时异常的发生。系统的 dao、service、controller 出现都通过 throws Exception 向上抛出，最后由 Springmvc 前端控制器交由异常处理器进行异常处理。</p>
<h3 id="8-3-2-编写自定义异常类和错误页面"><a href="#8-3-2-编写自定义异常类和错误页面" class="headerlink" title="8.3.2 编写自定义异常类和错误页面"></a>8.3.2 编写自定义异常类和错误页面</h3><h6 id="自定义异常继承Exception-生成构造方法即可"><a href="#自定义异常继承Exception-生成构造方法即可" class="headerlink" title="自定义异常继承Exception,生成构造方法即可"></a>自定义异常继承Exception,生成构造方法即可</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomException</span><span class="params">(String message, Throwable cause, <span class="keyword">boolean</span> enableSuppression, <span class="keyword">boolean</span> writableStackTrace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause, enableSuppression, writableStackTrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="编写错误页面error-jsp用以展示提示信息。"><a href="#编写错误页面error-jsp用以展示提示信息。" class="headerlink" title="编写错误页面error.jsp用以展示提示信息。"></a>编写错误页面error.jsp用以展示提示信息。</h6><h3 id="8-3-3-自定义异常处理器"><a href="#8-3-3-自定义异常处理器" class="headerlink" title="8.3.3 自定义异常处理器"></a>8.3.3 自定义异常处理器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//编写普通类实现org.springframework.web.servlet.HandlerExceptionResolver接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest httpServletRequest,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     HttpServletResponse httpServletResponse,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     Object o, Exception e)</span> </span>&#123;</span><br><span class="line">    CustomException exception = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> CustomException)&#123;<span class="comment">//若是自定义异常则转换</span></span><br><span class="line">        exception = (CustomException)e;<span class="comment">//使用时就封装好了消息</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;<span class="comment">//其他的异常,用自定义异常提示系统繁忙</span></span><br><span class="line">        exception = <span class="keyword">new</span> CustomException(<span class="string">"系统繁忙"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ModelAndView modelAndView = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">    modelAndView.setViewName(<span class="string">"error"</span>);</span><br><span class="line">    modelAndView.addObject(<span class="string">"msg"</span>,exception.getMessage());</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-4-配置异常处理器"><a href="#8-3-4-配置异常处理器" class="headerlink" title="8.3.4 配置异常处理器"></a>8.3.4 配置异常处理器</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置异常处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customExceptionResolver"</span> <span class="attr">class</span>=<span class="string">"cn.dintalk.web.resolver.CustomExceptionResolver"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>如此,当程序发生异常的时候,我们就可以截获异常,给用户一个友好的提示。</p>
<h1 id="9-文件的上传"><a href="#9-文件的上传" class="headerlink" title="9. 文件的上传"></a>9. 文件的上传</h1><p>​    要实现上传文件，对form表单有一定的要求：</p>
<ul>
<li>method必须是：post</li>
<li>表单的enctype：必须是 “multipart/form-data”</li>
<li>表单中提供type=”file”的上传输入域</li>
</ul>
<p><strong>Tips:</strong> 表单的enctype默认值为：application/x-www-form-urlencoded。修改为”multipart/form-data”后request.getParameter()等方法便获取不到数据了。</p>
<h2 id="9-1-准备上传页面"><a href="#9-1-准备上传页面" class="headerlink" title="9.1 准备上传页面"></a>9.1 准备上传页面</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>上传练习<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> <span class="attr">method</span>=<span class="string">"post"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath&#125;/upload/demo1"</span>&gt;</span></span><br><span class="line">    name:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"宋hui"</span>&gt;</span></span><br><span class="line">    file:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"photo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"上传"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="9-2-使用Commons-fileupload组件实现上传"><a href="#9-2-使用Commons-fileupload组件实现上传" class="headerlink" title="9.2 使用Commons-fileupload组件实现上传"></a>9.2 使用Commons-fileupload组件实现上传</h2><h5 id="第一步：导入jar包或Maven坐标-1"><a href="#第一步：导入jar包或Maven坐标-1" class="headerlink" title="第一步：导入jar包或Maven坐标"></a>第一步：导入jar包或Maven坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里会自动导入其所依赖的commos-io包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第二步：编写上传控制器"><a href="#第二步：编写上传控制器" class="headerlink" title="第二步：编写上传控制器"></a>第二步：编写上传控制器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/upload"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/demo1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">demo1</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建文件保存目录</span></span><br><span class="line">        String rootDir = request.getServletContext().getRealPath(<span class="string">"files"</span>);</span><br><span class="line">        String chiledDir = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        File dir = <span class="keyword">new</span> File(rootDir, chiledDir);</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists())</span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        <span class="comment">//2.创建文件解析工厂</span></span><br><span class="line">        DiskFileItemFactory diskFileItemFactory = <span class="keyword">new</span> DiskFileItemFactory();</span><br><span class="line">        <span class="comment">//3.获取解析器</span></span><br><span class="line">        ServletFileUpload upload = <span class="keyword">new</span> ServletFileUpload(diskFileItemFactory);</span><br><span class="line">        List&lt;FileItem&gt; fileItems = upload.parseRequest(request);</span><br><span class="line">        <span class="keyword">for</span> (FileItem fileItem : fileItems) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileItem.isFormField()) &#123;<span class="comment">//是普通字段</span></span><br><span class="line">                System.out.println(fileItem.getFieldName());<span class="comment">//字段的name</span></span><br><span class="line">                System.out.println(fileItem.getString(<span class="string">"utf-8"</span>));<span class="comment">//字段值</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 上传的文件</span></span><br><span class="line">                String fileName = fileItem.getName();<span class="comment">//获取文件名</span></span><br><span class="line">                String exName = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>));<span class="comment">//截取扩展名</span></span><br><span class="line">                String uuidName = UUID.randomUUID().toString().replace(<span class="string">"-"</span>, <span class="string">""</span>) + exName;</span><br><span class="line">                System.out.println(uuidName);</span><br><span class="line">                File target = <span class="keyword">new</span> File(dir, uuidName);</span><br><span class="line">                fileItem.write(target); <span class="comment">//写入文件</span></span><br><span class="line">                fileItem.delete();<span class="comment">//清除临时目录中的缓存</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-使用SpringMVC提供的组件上传"><a href="#9-3-使用SpringMVC提供的组件上传" class="headerlink" title="9.3 使用SpringMVC提供的组件上传"></a>9.3 使用SpringMVC提供的组件上传</h2><p>​    底层使用的还是apache的commons-fileupload组件。</p>
<h5 id="第一步：导入jar包或Maven坐标-2"><a href="#第一步：导入jar包或Maven坐标-2" class="headerlink" title="第一步：导入jar包或Maven坐标"></a>第一步：导入jar包或Maven坐标</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里会自动导入其所依赖的commos-io包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="第二步：编写上传控制器-1"><a href="#第二步：编写上传控制器-1" class="headerlink" title="第二步：编写上传控制器"></a>第二步：编写上传控制器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/upload"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/demo2"</span>)</span><br><span class="line">    <span class="comment">//参数名称需和表单的输入域名称保持一致</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">demo2</span><span class="params">(HttpServletRequest request, String username, MultipartFile photo)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1.创建目录</span></span><br><span class="line">        String rootDir = request.getServletContext().getRealPath(<span class="string">"files"</span>);</span><br><span class="line">        String chiledDir = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).format(<span class="keyword">new</span> Date());</span><br><span class="line">        File dir = <span class="keyword">new</span> File(rootDir, chiledDir);</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists())</span><br><span class="line">            dir.mkdirs();</span><br><span class="line">        <span class="comment">//2.读取数据进行保存</span></span><br><span class="line">        String fileName = photo.getOriginalFilename();<span class="comment">//获取文件名</span></span><br><span class="line">        String exName = fileName.substring(fileName.lastIndexOf(<span class="string">"."</span>));<span class="comment">//截取扩展名</span></span><br><span class="line">        String uuidName = UUID.randomUUID().toString().replace(<span class="string">"-"</span>, <span class="string">""</span>) + exName;</span><br><span class="line">        System.out.println(uuidName);</span><br><span class="line">        File target = <span class="keyword">new</span> File(dir, uuidName);</span><br><span class="line">        photo.transferTo(target);<span class="comment">//存放文件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="第三步：配置文件解析器"><a href="#第三步：配置文件解析器" class="headerlink" title="第三步：配置文件解析器"></a>第三步：配置文件解析器</h5><h6 id="webApplicationContext-xml文件"><a href="#webApplicationContext-xml文件" class="headerlink" title="webApplicationContext.xml文件"></a>webApplicationContext.xml文件</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 上传文件解析器配置：id值是固定的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置默认编码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 最大文件大小：字节为单位，这里配置文5M --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"5242880"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>










      

       <!-- 添加版权声明 -->
    

  <div class="declare">
    <strong>本文作者：</strong>
    
      Sunny 宋
    
    <br>
    <strong>本文链接：</strong>
    <a href="http://songhui.club/Spring/2020/SpringMVC-known.html" title="SpringMVC -- 必知必会" target="_blank">http://songhui.club/Spring/2020/SpringMVC-known.html</a>
    <br>
    <strong>版权声明：</strong>
    本作品采用
    <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    进行许可。转载请注明出处！
    
      <br>
      <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a>
    
  </div>

      <!-- 添加版权声明 -->

      <!-- 打赏 -->
      
        <div id="reward-btn">
          打赏
        </div>
        
    </div>
    <footer class="article-footer">
      <a data-url="http://songhui.club/Spring/2020/SpringMVC-known.html" data-id="ck5w6eh8x001yuo75bav467jh"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/source/tags/Spring/" rel="tag">Spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/source/tags/SpringMVC/" rel="tag">SpringMVC</a></li></ul>

    </footer>

  </div>

  
  
  <nav class="article-nav">
    
      <a href="/%E5%A4%A7%E6%95%B0%E6%8D%AE/2020/hadoop-install.html" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            Hadoop安装（单机版）
          
        </div>
      </a>
    
    
      <a href="/Spring/2020/ssm-group.html" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">SSM整合及聚合工程</div>
      </a>
    
  </nav>


  

  
  
<!-- valine评论 -->
<div id="vcomments-box">
    <div id="vcomments">
    </div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: 'To3Gl7KkEp8hH5GysSMcKLqm-gzGzoHsz',
        app_key: 'JqEmtmoB3PhzQrnq3HyYTV4k',
        path: window.location.pathname,
        avatar: 'mp',
        placeholder: '给我的文章加点评论吧~',
        recordIP: true
    });
    const infoEle = document.querySelector('#vcomments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
        infoEle.childNodes.forEach(function (item) {
            item.parentNode.removeChild(item);
        });
    }
</script>
<style>
    #vcomments-box {
        padding: 5px 30px;
    }

    @media screen and (max-width: 800px) {
        #vcomments-box {
            padding: 5px 0px;
        }
    }

    #vcomments-box #vcomments {
        background-color: #fff;
    }

    .v .vlist .vcard .vh {
        padding-right: 20px;
    }

    .v .vlist .vcard {
        padding-left: 10px;
    }
</style>

  

  
  
  

</article>
</section>
      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        Sunny 宋
      </li>
      <li>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    
    <aside class="sidebar">
      
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/logo2.png" alt="Sunny SongHui"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">目录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about/me.html">关于我</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="https://www.cnblogs.com/dintalk/" target="_blank" rel="noopener">博客园</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>


<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">



#上面是 yilia 主题配置自带 下面是我自己添加的js代码
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>


//这是自定一个js文件,放在 layout\_parial\post 目录 leancloud.ejs中
<script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
<script type="text/javascript"> 
if(true){
    var leancloud_app_id  = 'To3Gl7KkEp8hH5GysSMcKLqm-gzGzoHsz';
    var leancloud_app_key = 'JqEmtmoB3PhzQrnq3HyYTV4k';

    AV.init({
        appId: leancloud_app_id,
        appKey: leancloud_app_key
    });

    var pageViewsLength = $(".pageViews").length;

    var isIndex = $(".pageViews").length > 1 ?true:false;

    function showTime() {
        var Counter = AV.Object.extend("Counter");
        if(isIndex){
            $(".pageViews").each(function(){
                showPageViewsNum($(this),Counter);
                addPageViewsNum($(this));
            });
        }else{
            showPageViewsNum($(".pageViews"),Counter);
            addPageViewsNum($(".pageViews"));
        }
    }

    //显示阅读量
    function showPageViewsNum(ele,Counter){
        var query = new AV.Query("Counter");
        var url = ele.attr('id').trim();
            query.equalTo("words", url);
            query.count().then(function (number) {
                $(document.getElementById(url)).text(number?  number : '0');
            }, function (error) {
                 $(document.getElementById(url)).text('0');
            });
    }

    //追加阅读量
    function addPageViewsNum(ele){
        var url = ele.attr('id').trim();
        var Counter = AV.Object.extend("Counter");
        var query = new Counter;
        query.save({
            words: url
        }).then(function (object) {});
    }

    if(pageViewsLength){ //此处判断等于 1 在执行 可去除循环
        showTime();
    }
}
</script> 


#下面是 yilia 主题配置自带

<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  
  
  </div>
  <!-- 代码块复制功能 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<!-- <script type="text/javascript" src="/js/clipboard.js"></script>  -->
<script type="text/javascript" src="/js/clipboard_use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"superSample":2,"width":300,"height":600,"position":"left","hOffset":0,"vOffset":-20},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
</html>