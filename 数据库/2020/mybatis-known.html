<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
    MyBatis -- 必知必会 |  Sunny SongHui
  </title>
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
<script src="/js/pace.min.js"></script>


  

  

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Sunny SongHui" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    <main class="content">
      <section class="outer">
  <article id="post-MyBatis-必知必会" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  MyBatis -- 必知必会
</h1>
  

    </header>
    

    
    <div class="article-meta" style="align:center">
      <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2020/mybatis-known.html" class="article-date">
  <time datetime="2020-01-12T14:07:57.000Z" itemprop="datePublished">2020-01-12</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/source/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

      
      &nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp; 阅读次数:&nbsp;&nbsp;<span id="/%E6%95%B0%E6%8D%AE%E5%BA%93/2020/mybatis-known.html" class="pageViews">0</span>次
    
       <!-- 开始添加字数统计-->
        
          <div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <span class="post-count">6.8k字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">30分</span>
      </span>
    </span>
</div>
          
        <!-- 添加完成 -->
    </div>
    

    
    
    <div class="tocbot"></div>





    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>​    MyBatis的前身是Apache的一个开源项目iBatis，2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis。2013年11月迁移到GitHub，因此目前MyBatis是由GitHub维护的。同样作为持久层框架的Hibernate在前些年非常的火，它在配置了映射文件和数据库连接文件后就可以通过Session操作，它甚至提供了HQL去操作POJO进而操作数据库的数据，几乎可以使编程人员脱离sql语言。可是为什么MyBatis却越来越受欢迎呢？</p>
<a id="more"></a>

<p>我们稍稍总结如下,Hibernate: </p>
<ul>
<li>不方便的全表映射，比如更新时需要发送所有的字段；</li>
<li>无法根据不同的条件组装不同sql;</li>
<li>对多表关联和复制sql查询支持较差；</li>
<li>有HQL但性能较差，做不到sql优化；</li>
<li>不能有效支持存储过程；</li>
</ul>
<p>​    在当今的大型互联网中，灵活、sql优化，减少数据的传递是最基本的优化方法，但是Hibernate却无法满足我们的需求，而MyBatis提供了更灵活、更方便的方法。在MyBatis里，我们需要自己编写sql，虽然比Hibernate配置要多，但是是MyBatis可以配置动态sql，也可以优化sql,且支持存储过程，MyBatis几乎能做到 JDBC 所能做到的所有事情！凭借其高度灵活、可优化、易维护等特点，成为目前大型移动互联网项目的首选框架</p>
<h1 id="1-开发环境、流程及生命周期"><a href="#1-开发环境、流程及生命周期" class="headerlink" title="1.开发环境、流程及生命周期"></a>1.开发环境、流程及生命周期</h1><h2 id="1-1开发环境"><a href="#1-1开发环境" class="headerlink" title="1.1开发环境"></a>1.1开发环境</h2><h3 id="1-1-1-导入依赖jar包"><a href="#1-1-1-导入依赖jar包" class="headerlink" title="1.1.1 导入依赖jar包"></a>1.1.1 导入依赖jar包</h3><ul>
<li>导入mybatis的jar包，如果采用Maven进行部署，只需导入mybatis坐标。</li>
<li>导入数据库驱动jar包或坐标。</li>
<li>代码调试阶段可导入日志工具jar包或坐标，如log4j。</li>
<li>导入Junit单元测试坐标。</li>
</ul>
<h3 id="1-1-2-创建mybatis的主配置文件"><a href="#1-1-2-创建mybatis的主配置文件" class="headerlink" title="1.1.2 创建mybatis的主配置文件"></a>1.1.2 创建mybatis的主配置文件</h3><p>​    在resources目录下建立一个名字为mybatis-config.xml（名称随意）配置文件，编写所需配置信息。</p>
<h3 id="1-1-3-准备实体类和表结构"><a href="#1-1-3-准备实体类和表结构" class="headerlink" title="1.1.3 准备实体类和表结构"></a>1.1.3 准备实体类和表结构</h3><p>​    遵循开发规范：</p>
<ul>
<li><p>类属性命名尽量和表字段保持一致。</p>
</li>
<li><p>实体类实现序列化接口。</p>
</li>
<li><p>实体类属性使用包装类型定义，如Integer。</p>
<p><strong>Tips:</strong> 有时可以考虑通过定义时初始化来避免可能的空指针异常！</p>
<p>​    如：private List<String> list = new ArrayList&lt;&gt;() ;</p>
</li>
</ul>
<h3 id="1-1-4-创建Mapper接口（Dao接口）建立接口方法和sql映射文件"><a href="#1-1-4-创建Mapper接口（Dao接口）建立接口方法和sql映射文件" class="headerlink" title="1.1.4 创建Mapper接口（Dao接口）建立接口方法和sql映射文件"></a>1.1.4 创建Mapper接口（Dao接口）建立接口方法和sql映射文件</h3><p>创建Mapper接口，在内定义CRUD方法。</p>
<p>​    <strong>Tips:</strong>方法名唯一，需要在对应的mapper.xml文件中配置id。</p>
<p>在resources下创建sql映射文件。</p>
<p>​    <strong>Tips:</strong> 同对应的Mapper接口保持包结构及命名一致。</p>
<p>​    如：Mapper接口： cn.dintalk.dao.UserMapper</p>
<p>​        对应配置文件：cn.dintalk.dao.UserMapper.xml       </p>
<h3 id="1-1-5-将映射文件加入到mybatis主配置文件中"><a href="#1-1-5-将映射文件加入到mybatis主配置文件中" class="headerlink" title="1.1.5 将映射文件加入到mybatis主配置文件中"></a>1.1.5 将映射文件加入到mybatis主配置文件中</h3><p>将映射文件通过引入的方式加入到mybatis的主配置文件中。</p>
<p>​    <strong>Tips:</strong> 所有映射文件会随主配置文件在程序运行时加入内存，任一映射文件出错都会导致整个环境报错！（初学者经常搞混resultType和resultMap)。</p>
<h4 id="1-1-6-编写代码进行CRUD操作"><a href="#1-1-6-编写代码进行CRUD操作" class="headerlink" title="1.1.6 编写代码进行CRUD操作"></a>1.1.6 编写代码进行CRUD操作</h4><p>在映射文件中编写sql进行crud操作，在单元测试中，或service层中调用方法！</p>
<h2 id="1-2开发流程"><a href="#1-2开发流程" class="headerlink" title="1.2开发流程"></a>1.2开发流程</h2><p>环境搭建好后开发基本流程为：</p>
<ul>
<li>接口定义方法 。</li>
<li>Mapper.xml文件中编写sql。</li>
<li>单元测试或service调用。</li>
</ul>
<h6 id="Tips-接口中方法名称和Mapper-xml文件中sql语句的id保持一致！"><a href="#Tips-接口中方法名称和Mapper-xml文件中sql语句的id保持一致！" class="headerlink" title="Tips: 接口中方法名称和Mapper.xml文件中sql语句的id保持一致！"></a>Tips: 接口中方法名称和Mapper.xml文件中sql语句的id保持一致！</h6><h2 id="1-3生命周期"><a href="#1-3生命周期" class="headerlink" title="1.3生命周期"></a>1.3生命周期</h2><p>MyBatis的核心组件：</p>
<ul>
<li><p>SqlSessionFactoryBuilder(构造器)：根据配置信息或代码生成SqlSessionFactory</p>
</li>
<li><p>SqlSessionFactory(工厂接口):依靠工厂来生成SqlSession(会话)。</p>
</li>
<li><p>SqlSession(会话): 既可以发生sql去执行并返回结果，也可以获取Mapper的接口</p>
</li>
<li><p>SQL Mapper:它是MyBatis新设计的组件，它是由一个java接口和xml文件（或注解）构成的，需要给出对应的sql和映射规则。它负责发送sql去执行，并返回结果。</p>
<p>​    正确理解并掌握上述核心组件的生命周期可以让我们写出高效的程序，还可避免带来严重的并发问题。</p>
</li>
</ul>
<h3 id="1-3-1-SqlSessionFactoryBuilder"><a href="#1-3-1-SqlSessionFactoryBuilder" class="headerlink" title="1.3.1 SqlSessionFactoryBuilder"></a>1.3.1 SqlSessionFactoryBuilder</h3><p>​    其作用就是利用xml或java编码获得资源来构建SqlSessionFactory对象，构建成功就失去了存在的意义，将其回收。所以它的生命周期只存在于方法的局部。</p>
<h3 id="1-3-2-SqlSessionFactory"><a href="#1-3-2-SqlSessionFactory" class="headerlink" title="1.3.2 SqlSessionFactory"></a>1.3.2 SqlSessionFactory</h3><p>​    SqlSessionFactory的作用是创建SqlSession，而SqlSession就是一个会话，相当于JDBC中的Connection对象，每次访问数据库都需要通过SqlSessionFactory创建SqlSession，所以SqlSessionFactory应该在MyBatis应用的整个生命周期中。我们使每一个数据库只对应一个SqlSessionFactory（单例模式）。</p>
<h3 id="1-3-3-SqlSession"><a href="#1-3-3-SqlSession" class="headerlink" title="1.3.3 SqlSession"></a>1.3.3 SqlSession</h3><p>​    SqlSession是一个会话，相当于JDBC的一个Connection对象，它的生命周期应该是在请求数据库处理事务的过程中。是一个线程不安全的对象，涉及多线程时格外当心。此外，每次创建的SqlSession都必须及时关闭它。</p>
<h3 id="1-3-4-Mapper"><a href="#1-3-4-Mapper" class="headerlink" title="1.3.4 Mapper"></a>1.3.4 Mapper</h3><p>​    Mapper是一个接口，没有任何实现类，其作用是发送sql,返回我们需要的结果，或者执行sql修改数据库数据，因此它也因该在一个SqlSession事务方法之内，是一个方法级别的东西。就如同 JDBC中的一条sql语句的执行，它的最大范围和SqlSession是相同的。</p>
<h6 id="Tips-根据核心组件封装工具、形成SqlSession使用模板"><a href="#Tips-根据核心组件封装工具、形成SqlSession使用模板" class="headerlink" title="Tips: 根据核心组件封装工具、形成SqlSession使用模板"></a>Tips: 根据核心组件封装工具、形成SqlSession使用模板</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory build =<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;  <span class="comment">//使用MyBatis的Resources加载资源获得输入流，构建工厂</span></span><br><span class="line">            InputStream inputStream = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">            build = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"资源文件加载失败!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//使用工厂生产sqlSession </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">openSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> build.openSession();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="SqlSession使用方法"><a href="#SqlSession使用方法" class="headerlink" title="SqlSession使用方法"></a>SqlSession使用方法</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.定义sqlSession</span></span><br><span class="line">SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sqlSession = openSession();</span><br><span class="line">    <span class="comment">//2.获取映射器</span></span><br><span class="line">    UserMapper mapper = sqlSession.getMapper(UserMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">//3.some code like 'User u = mapper.findById(id);'</span></span><br><span class="line">    <span class="comment">//4.sqlSession不提交默认回滚！增删改需格外注意！</span></span><br><span class="line">    sqlSession.commit();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (sqlSession != <span class="keyword">null</span>) &#123;</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-映射器"><a href="#2-映射器" class="headerlink" title="2.映射器"></a>2.映射器</h1><h2 id="2-1映射器元素简介"><a href="#2-1映射器元素简介" class="headerlink" title="2.1映射器元素简介"></a>2.1映射器元素简介</h2><p>我们可以在映射器中定义哪些元素，以及它们有何作用呢？</p>
<table>
<thead>
<tr>
<th>元素名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>insert</td>
<td>定义插入语句</td>
</tr>
<tr>
<td>delete</td>
<td>定义删除语句</td>
</tr>
<tr>
<td>update</td>
<td>定义修改语句</td>
</tr>
<tr>
<td>select</td>
<td>定义查询语句</td>
</tr>
<tr>
<td>parameterMap</td>
<td>定义参数映射关系</td>
</tr>
<tr>
<td>resultMap</td>
<td>提供从数据库结果集到POJO映射规则</td>
</tr>
<tr>
<td>cache</td>
<td>配置当前命名空间的缓存配置（二级缓存）</td>
</tr>
<tr>
<td>sql</td>
<td>定义部分sql，各个地方都可引用</td>
</tr>
<tr>
<td>cache-ref</td>
<td>引用其他命名空间的缓存配置</td>
</tr>
</tbody></table>
<p>在各个元素当中又有相当多的属性配置项，这里不多赘述，通过下一节掌握常用的内容即可。这里特别说明sql元素的使用：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"user_columns"</span>&gt;</span>  <span class="comment">&lt;!-- 此处定义后，处处使用，尤其字段多的时候 --&gt;</span></span><br><span class="line">	id, name, password   </span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">....</span>&gt;</span></span><br><span class="line">	select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">"user_columns"</span>/&gt;</span> from users where uid=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2简单CRUD操作"><a href="#2-2简单CRUD操作" class="headerlink" title="2.2简单CRUD操作"></a>2.2简单CRUD操作</h2><h3 id="2-2-1添加用户"><a href="#2-2-1添加用户" class="headerlink" title="2.2.1添加用户"></a>2.2.1添加用户</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.添加用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    INSERT into users (name,password) VALUES (#&#123;name&#125;,#&#123;password&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-2添加用户并返回数据库中的主键"><a href="#2-2-2添加用户并返回数据库中的主键" class="headerlink" title="2.2.2添加用户并返回数据库中的主键"></a>2.2.2添加用户并返回数据库中的主键</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.添加用户,获取数据库生成的主键值(需数据库具备主键自增功能) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"uid"</span>&gt;</span></span><br><span class="line">    insert into users (name,password) values(#&#123;name&#125;,#&#123;password&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 3.添加用户,获取数据库生成的主键:数据库有无自动增长能力都可以--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">"uid"</span> <span class="attr">keyProperty</span>=<span class="string">"uid"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></span><br><span class="line">        select last_insert_id();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into users (name,password) values(#&#123;name&#125;,#&#123;password&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-3修改-删除用户"><a href="#2-2-3修改-删除用户" class="headerlink" title="2.2.3修改/删除用户"></a>2.2.3修改/删除用户</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 4.修改/删除用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    update users set name=#&#123;name&#125;,password=#&#123;password&#125; where uid=#&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span> &gt;</span></span><br><span class="line">    delete from users where uid=#&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-4查询用户"><a href="#2-2-4查询用户" class="headerlink" title="2.2.4查询用户"></a>2.2.4查询用户</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 5.查询所有的用户 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义查询结果映射规则(结果集映射可以用别名) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"uid"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"姓名"</span> <span class="attr">property</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">    select uid as id,name as '姓名',password from users;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--6.根据用户id查询用户(单个参数)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select uid,name,password from users where uid=#&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 7.根据用户名和密码查询用户(接口定义方法参数时@Param(" ")进行指定,否则多个参数时</span></span><br><span class="line"><span class="comment">默认使用 arg0,arg1   或param1,param2来映射) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByNamePassword"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select uid,name,password from users where name=#&#123;name&#125; and password=#&#123;password&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 8.根据用户实体对象查询用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUser"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select uid,name,password from users where name=#&#123;name&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 9.根据用户名进行模糊查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUsersLikeName"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select uid,name,password from users where name like concat("%",#&#123;name&#125;,"%");</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong>  sql中如果有特殊符号可使用 <![CDATA[    ]]> 将语句抱起来。</p>
<h1 id="3-动态sql和高级查询"><a href="#3-动态sql和高级查询" class="headerlink" title="3.动态sql和高级查询"></a>3.动态sql和高级查询</h1><h2 id="3-1动态sql"><a href="#3-1动态sql" class="headerlink" title="3.1动态sql"></a>3.1动态sql</h2><p>​    MyBatis的动态sql包含这些元素：if  |  choose(when ohterwise) |trim(where set) | foreach ，通过这些元素来动态组装sql语句，主要是增改查操作。<strong>(实际开发中，严禁使用select * 操作。这里为了简便使用select *演示）！</strong></p>
<h3 id="3-1-1使用-if-实现动态sql-完成查询操作"><a href="#3-1-1使用-if-实现动态sql-完成查询操作" class="headerlink" title="3.1.1使用 if,实现动态sql,完成查询操作"></a>3.1.1使用 if,实现动态sql,完成查询操作</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.使用if,实现动态sql,完成查询操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select uid,name,password,email from users where 1 = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and name !=''"</span>&gt;</span></span><br><span class="line">        and name like concat("%",#&#123;name&#125;,"%")</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">        and password = #&#123;password&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-2使用if-实现动态sql-完成更新操作"><a href="#3-1-2使用if-实现动态sql-完成更新操作" class="headerlink" title="3.1.2使用if,实现动态sql,完成更新操作"></a>3.1.2使用if,实现动态sql,完成更新操作</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.使用if,实现动态sql,完成更新操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">   update users set</span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and name != '' "</span>&gt;</span></span><br><span class="line">       name=#&#123;name&#125;,</span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">       password=#&#123;password&#125;,</span><br><span class="line">   <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   uid=#&#123;uid&#125; where uid=#&#123;uid&#125;; <span class="comment">&lt;!-- 保证任何情况下的sql完整 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-3使用if-实现动态sql-完成添加操作"><a href="#3-1-3使用if-实现动态sql-完成添加操作" class="headerlink" title="3.1.3使用if,实现动态sql,完成添加操作"></a>3.1.3使用if,实现动态sql,完成添加操作</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3.使用if,实现动态sql,完成添加操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addUser"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    insert into users (name,</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">        password,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>email,phoneNumber,birthday) values(#&#123;name&#125;,</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">        #&#123;password&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span>#&#123;email&#125;,#&#123;phoneNumber&#125;,#&#123;birthday&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-4使用choose-when-otherwise-实现动态sql-完成查询操作"><a href="#3-1-4使用choose-when-otherwise-实现动态sql-完成查询操作" class="headerlink" title="3.1.4使用choose  when  otherwise,实现动态sql,完成查询操作"></a>3.1.4使用choose  when  otherwise,实现动态sql,完成查询操作</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 4.使用choose when otherwise,实现动态sql,完成查询操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from users where 1 = 1 <span class="comment">&lt;!-- 动态组装准备 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"name != null and name != '' "</span>&gt;</span></span><br><span class="line">            and name like concat("%",#&#123;name&#125;,"%");</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            and 1 = 2; <span class="comment">&lt;!-- 动态否决 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-5使用if和where-实现动态sql-完成查询操作-★★★"><a href="#3-1-5使用if和where-实现动态sql-完成查询操作-★★★" class="headerlink" title="3.1.5使用if和where,实现动态sql,完成查询操作  ★★★"></a>3.1.5使用if和where,实现动态sql,完成查询操作  ★★★</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 5.使用if和where,实现动态sql,完成查询操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">resultType</span>=<span class="string">"user"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from users</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span>  <span class="comment">&lt;!-- 至少有一个if执行时才会加上where关键字并去掉紧跟后面的and|or关键字 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and name != '' "</span>&gt;</span></span><br><span class="line">            and name like concat("%",#&#123;name&#125;,"%")</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">            and password=#&#123;password&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-6使用if和set-实现动态sql-完成更新操作-★★"><a href="#3-1-6使用if和set-实现动态sql-完成更新操作-★★" class="headerlink" title="3.1.6使用if和set,实现动态sql,完成更新操作 ★★"></a>3.1.6使用if和set,实现动态sql,完成更新操作 ★★</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 6.使用if和set,实现动态sql,完成更新操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateUser"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    update users</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span>   <span class="comment">&lt;!-- set元素会去掉最后一个,号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and name != '' "</span>&gt;</span></span><br><span class="line">            name=#&#123;name&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">            password=#&#123;password&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        uid=#&#123;uid&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where uid=#&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- trim元素的使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"where"</span> <span class="attr">prefixOverrides</span>=<span class="string">"and|or"</span>&gt;</span><span class="tag">&lt;/<span class="name">trim</span>&gt;</span> <span class="comment">&lt;!-- 等同与where元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"set"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span>&gt;</span><span class="tag">&lt;/<span class="name">trim</span>&gt;</span> <span class="comment">&lt;!-- 等同与set元素 --&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-7使用foreach-实现动态sql-完成根据id集合、数组等的查询操作"><a href="#3-1-7使用foreach-实现动态sql-完成根据id集合、数组等的查询操作" class="headerlink" title="3.1.7使用foreach,实现动态sql,完成根据id集合、数组等的查询操作"></a>3.1.7使用foreach,实现动态sql,完成根据id集合、数组等的查询操作</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 7.使用foreach,实现动态sql,完成根据id list列表的查询操作 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByIds"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from users where uid in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"collection"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">item</span>=<span class="string">"uid"</span>&gt;</span></span><br><span class="line">        #&#123;uid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- foreach中的collection值取决于要遍历的对象类型(mybatis内部做判断后默认的)</span></span><br><span class="line"><span class="comment"> List : 可取 collection或list</span></span><br><span class="line"><span class="comment"> Set  : 取 collection</span></span><br><span class="line"><span class="comment"> Array: 取 array</span></span><br><span class="line"><span class="comment"> Map  : 取 _parameter   （用map无意义，遍历的依旧是value）</span></span><br><span class="line"><span class="comment">上述默认引用都可以在接口方法中通过@Param（“  ”）覆盖掉！</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-8bind元素"><a href="#3-1-8bind元素" class="headerlink" title="3.1.8bind元素"></a>3.1.8bind元素</h3><p>​    bind元素的作用是通过OGNL表达式自定义一个上下文变量，这样更方便我们使用。在进行模糊查询的时候，如果是MySQL数据库，我们常用concat函数用“%”和参数连接。然而在Oracle数据则是用连接符号“||”。这样sql就需要提供两种形式去实现。用bind元素，我们就不必使用数据库语言，只要使用MyBatis的语言即可与所需参数相连。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByCondition"</span> <span class="attr">parameterType</span>=<span class="string">"user"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用bind定义上下文变量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">"'%' + name + '%' "</span>/&gt;</span></span><br><span class="line">    select uid,name,password,email from users where 1 = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null and name !=''"</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- and name like concat("%",#&#123;name&#125;,"%") --&gt;</span></span><br><span class="line">        and name like #&#123;pattern&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null and password != '' "</span>&gt;</span></span><br><span class="line">        and password = #&#123;password&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2高级查询（多表查询）"><a href="#3-2高级查询（多表查询）" class="headerlink" title="3.2高级查询（多表查询）"></a>3.2高级查询（多表查询）</h2><h3 id="3-2-1一对多关联查询"><a href="#3-2-1一对多关联查询" class="headerlink" title="3.2.1一对多关联查询"></a>3.2.1一对多关联查询</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.使用多表查询,完成一对多关联查询及映射 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- user结果集封装,可以通过继承重复使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"uid"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- loginInfo结果集,继承user结果集完整数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userLoginInfoMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 使用collection映射多的一方,ofType指定集合中的数据类型 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"loginInfos"</span> <span class="attr">ofType</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lid"</span> <span class="attr">property</span>=<span class="string">"lid"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ip"</span> <span class="attr">property</span>=<span class="string">"ip"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"loginTime"</span> <span class="attr">property</span>=<span class="string">"loginTime"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义查询语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllUsers"</span> <span class="attr">resultMap</span>=<span class="string">"userLoginInfoMap"</span>&gt;</span></span><br><span class="line">    select * from users u left join login_infos li on u.uid = li.uid;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-2多对一关联查询-别名映射-resultMap映射-resultMap结合association映射"><a href="#3-2-2多对一关联查询-别名映射-resultMap映射-resultMap结合association映射" class="headerlink" title="3.2.2多对一关联查询(别名映射|resultMap映射|resultMap结合association映射)"></a>3.2.2多对一关联查询(别名映射|resultMap映射|resultMap结合association映射)</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 2.多对一,采用别名映射关联关系 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllLoginInfos"</span> <span class="attr">resultType</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    select li.*,</span><br><span class="line">    u.uid "user.uid",</span><br><span class="line">    u.name "user.name",</span><br><span class="line">    u.password "user.password"</span><br><span class="line">    from login_infos li,users u</span><br><span class="line">    where li.uid = u.uid;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 3.多对一,采用resultMap进行结关联关系的映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"user.uid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"user.name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"user.password"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span>    </span><br><span class="line"><span class="comment">&lt;!-- 这里的resultMap继承关系最好和POJO中的关联关系保持一致，便于理解</span></span><br><span class="line"><span class="comment">	 这里不一致，但也可以运行</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userLoginInfoMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lid"</span> <span class="attr">property</span>=<span class="string">"lid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ip"</span> <span class="attr">property</span>=<span class="string">"ip"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"loginTime"</span> <span class="attr">property</span>=<span class="string">"loginTime"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllLoginInfos1"</span> <span class="attr">resultMap</span>=<span class="string">"userLoginInfoMap"</span>&gt;</span></span><br><span class="line">    select * from users u,login_infos li where u.uid=li.uid;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 4.多对一,使用resultMap结合association进行关联关系的映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"loginInfoMap"</span> <span class="attr">type</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lid"</span> <span class="attr">property</span>=<span class="string">"lid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ip"</span> <span class="attr">property</span>=<span class="string">"ip"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"loginTime"</span> <span class="attr">property</span>=<span class="string">"loginTime"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里的resultMap继承关系和POJO的关联关系保持了一致，即LoginInfo下有User属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"loginInfoUserMap"</span> <span class="attr">extends</span>=<span class="string">"loginInfoMap"</span> <span class="attr">type</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"uid"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"password"</span> <span class="attr">property</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllLoginInfos2"</span> <span class="attr">resultMap</span>=<span class="string">"loginInfoUserMap"</span>&gt;</span></span><br><span class="line">    select * from users u,login_infos li where u.uid=li.uid;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-3多对多关联查询"><a href="#3-2-3多对多关联查询" class="headerlink" title="3.2.3多对多关联查询"></a>3.2.3多对多关联查询</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 13.使用多表查询,完成多对多查询,查找所有的用户及其角色 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注意：为了避免冗余，这里继承了2.2中的resultMap --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userRoleMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"role"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"rid"</span> <span class="attr">property</span>=<span class="string">"rid"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"description"</span> <span class="attr">property</span>=<span class="string">"description"</span>/&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 多对多主要在sql编写上，需要借助中间表 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllUsers"</span> <span class="attr">resultMap</span>=<span class="string">"userRoleMap"</span>&gt;</span></span><br><span class="line">     select * from users u left join users_roles ur </span><br><span class="line">     on u.uid=ur.uid inner join roles r on ur.rid=r.rid;</span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="4-嵌套查询和延迟加载"><a href="#4-嵌套查询和延迟加载" class="headerlink" title="4.嵌套查询和延迟加载"></a>4.嵌套查询和延迟加载</h1><h2 id="4-1加载策略"><a href="#4-1加载策略" class="headerlink" title="4.1加载策略"></a>4.1加载策略</h2><p>​    在关联查询时，对于关联的一方是否查询出来，要根据业务需求而定。不能通过编码方式进行策略的改变，而应该通过修改配置文件改变加载策略。可以使用嵌套查询（分步查询）。</p>
<h2 id="4-2嵌套查询"><a href="#4-2嵌套查询" class="headerlink" title="4.2嵌套查询"></a>4.2嵌套查询</h2><h3 id="4-2-1根据多的一方，嵌套查询少的一方"><a href="#4-2-1根据多的一方，嵌套查询少的一方" class="headerlink" title="4.2.1根据多的一方，嵌套查询少的一方"></a>4.2.1根据多的一方，嵌套查询少的一方</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.嵌套查询,使用reultMap结合association使用引用的mapper.xml进行查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"loginInfoMap"</span> <span class="attr">type</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"lid"</span> <span class="attr">property</span>=<span class="string">"lid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"ip"</span> <span class="attr">property</span>=<span class="string">"ip"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"loginTime"</span> <span class="attr">property</span>=<span class="string">"loginTime"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"loginInfoUserMap"</span> <span class="attr">extends</span>=<span class="string">"loginInfoMap"</span> <span class="attr">type</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 解决user属性: property:属性</span></span><br><span class="line"><span class="comment">		column:查询依据，也是当前查询表的外键</span></span><br><span class="line"><span class="comment">        select:指向根据外键查询的xml唯一映射</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> </span></span><br><span class="line"><span class="tag">                 <span class="attr">select</span>=<span class="string">"cn.dintalk.UserMapper.findById"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllLoginInfos3"</span> <span class="attr">resultMap</span>=<span class="string">"loginInfoUserMap"</span>&gt;</span></span><br><span class="line">    select * from login_infos;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在association中，select指向的是另一个Mapper.xml文件中的映射（根据命名空间和id) --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- UserMapper.xml中  14.嵌套查询之 根据uid查询用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    select * from users where uid = #&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-2根据少的一方，嵌套查询多的一方"><a href="#4-2-2根据少的一方，嵌套查询多的一方" class="headerlink" title="4.2.2根据少的一方，嵌套查询多的一方"></a>4.2.2根据少的一方，嵌套查询多的一方</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.使用嵌套查询,可通过懒加载优化sql,查询所有的用户及其日志信息 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 为了简便，这里继承了上述的id为userMap的resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"userLoginInfoMap"</span> <span class="attr">extends</span>=<span class="string">"userMap"</span> <span class="attr">type</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"loginInfos"</span>  <span class="attr">column</span>=<span class="string">"uid"</span> </span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">"cn.dintalk.dao.LoginInfoMapper.findAllLoginInfos"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllUser"</span> <span class="attr">resultMap</span>=<span class="string">"userLoginInfoMap1"</span>&gt;</span></span><br><span class="line">    select * from users;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 同理，在collection中，select指向的是另一个Mapper.xml文件的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--LoginInfoMapper.xml中  5.根据用户id查询所有的登录信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllLoginInfos"</span> <span class="attr">resultType</span>=<span class="string">"loginInfo"</span>&gt;</span></span><br><span class="line">    select * from login_infos where uid=#&#123;uid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-3配置延迟加载"><a href="#4-3配置延迟加载" class="headerlink" title="4.3配置延迟加载"></a>4.3配置延迟加载</h2><h3 id="4-3-1全局配置，修改mybatis-xml主配置文件"><a href="#4-3-1全局配置，修改mybatis-xml主配置文件" class="headerlink" title="4.3.1全局配置，修改mybatis.xml主配置文件"></a>4.3.1全局配置，修改mybatis.xml主配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.配置延迟加载,即sql优化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启用懒加载策略 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 覆盖掉延迟加载的触发方法 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>启用延迟加载后，mybatis默认有toString、equals等4个触发加载的方法。我们也可以将其覆盖掉。</p>
<p>延迟加载，即用到关联数据的时候再去查，不用就不查。（service层中会有很多方法调用dao方法，根据service层中的实际需求动态调整加载策略，高效利用资源！)</p>
<h3 id="4-3-2每个association和collection都有fetchType属性"><a href="#4-3-2每个association和collection都有fetchType属性" class="headerlink" title="4.3.2每个association和collection都有fetchType属性"></a>4.3.2每个association和collection都有fetchType属性</h3><h6 id="该属性的值或覆盖掉全局配置"><a href="#该属性的值或覆盖掉全局配置" class="headerlink" title="该属性的值或覆盖掉全局配置"></a>该属性的值或覆盖掉全局配置</h6><p>fetchType=”lazy”(默认） | eager</p>
<ul>
<li>lazy ： 支持延迟加载</li>
<li>eager : 立即加载</li>
</ul>
<h1 id="5-事务控制及数据源"><a href="#5-事务控制及数据源" class="headerlink" title="5.事务控制及数据源"></a>5.事务控制及数据源</h1><h2 id="5-1事务控制"><a href="#5-1事务控制" class="headerlink" title="5.1事务控制"></a>5.1事务控制</h2><h6 id="默认情况下：MySql的事务是自动提交的。"><a href="#默认情况下：MySql的事务是自动提交的。" class="headerlink" title="默认情况下：MySql的事务是自动提交的。"></a>默认情况下：MySql的事务是自动提交的。</h6><p>​    通过 JDBC 可以手动控制：</p>
<p>​        Connection.setAutoCommit(false);</p>
<p>​        Connection.commit();</p>
<p>​        Connection.rollback();// 开启事务后，未提交会自动回滚！</p>
<h6 id="MyBatis中-mybatis-config-xml-作如下配置"><a href="#MyBatis中-mybatis-config-xml-作如下配置" class="headerlink" title="MyBatis中: mybatis-config.xml 作如下配置"></a>MyBatis中: mybatis-config.xml 作如下配置</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>相当于使用 JDBC 进行事务控制：（增删改时不提交会自动回滚！）</p>
<p>获取SqlSession时：SqlSessionFactory.openSession();  // 手动控制事务  ★</p>
<p>​                   SqlSessionFactory.openSession(true); //自动提交事务</p>
<h2 id="5-2数据源"><a href="#5-2数据源" class="headerlink" title="5.2数据源"></a>5.2数据源</h2><h3 id="5-2-1mybatis内置数据源"><a href="#5-2-1mybatis内置数据源" class="headerlink" title="5.2.1mybatis内置数据源"></a>5.2.1mybatis内置数据源</h3><p>mybatis内置了三种数据源：</p>
<p>UNPOOLED :不带有池（连接池）|学习时用</p>
<p>POOLED : 带有池的 | 实际生产环境使用</p>
<p>JNDI : mybatis提供的JndiDataSourceFactory来获取数据源</p>
<h3 id="5-2-2内部原理"><a href="#5-2-2内部原理" class="headerlink" title="5.2.2内部原理"></a>5.2.2内部原理</h3><p>POOLED对应的是PooledDataSource数据源，PooledDataSourceFactory用来生产带有池的数据源。</p>
<p>UNPOOLED对应的是UnpooledDataSource数据源，UnpooledDataSourceFactory用来生产不带有池的数据源。</p>
<h3 id="5-2-3使用Druid等第三方数据源-以Druid为例"><a href="#5-2-3使用Druid等第三方数据源-以Druid为例" class="headerlink" title="5.2.3使用Druid等第三方数据源(以Druid为例)"></a>5.2.3使用Druid等第三方数据源(以Druid为例)</h3><h6 id="第一步：引入Druid的Jar包或数据源"><a href="#第一步：引入Druid的Jar包或数据源" class="headerlink" title="第一步：引入Druid的Jar包或数据源"></a>第一步：引入Druid的Jar包或数据源</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="第二步：编写工厂类，用来产生Druid的数据源，一般选择继承UnpooledDataSourceFactory"><a href="#第二步：编写工厂类，用来产生Druid的数据源，一般选择继承UnpooledDataSourceFactory" class="headerlink" title="第二步：编写工厂类，用来产生Druid的数据源，一般选择继承UnpooledDataSourceFactory"></a>第二步：编写工厂类，用来产生Druid的数据源，一般选择继承UnpooledDataSourceFactory</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceFactory</span> <span class="keyword">extends</span> <span class="title">UnpooledDataSourceFactory</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataSourceFactory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.dataSource = <span class="keyword">new</span> DruidDataSource();<span class="comment">//创建druid数据源</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="第三步：在mybatis-config-xml中进行配置"><a href="#第三步：在mybatis-config-xml中进行配置" class="headerlink" title="第三步：在mybatis-config.xml中进行配置"></a>第三步：在mybatis-config.xml中进行配置</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.类别名的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"cn.dintalk.dataSource.DataSourceFactory"</span> <span class="attr">alias</span>=<span class="string">"DRUID"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 2.配置druid数据源 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dataSource</span>  <span class="attr">type</span>=<span class="string">"DRUID"</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!-- 3.配置数据库连接：name由数据源中的setXXX而定，value是外部配置的key --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-MyBatis的缓存"><a href="#6-MyBatis的缓存" class="headerlink" title="6.MyBatis的缓存"></a>6.MyBatis的缓存</h1><h2 id="6-1系统缓存"><a href="#6-1系统缓存" class="headerlink" title="6.1系统缓存"></a>6.1系统缓存</h2><p>MyBatis对缓存提供支持，但是在没有配置的默认情况下，它只开启一级缓存。</p>
<h3 id="6-1-1一级缓存"><a href="#6-1-1一级缓存" class="headerlink" title="6.1.1一级缓存"></a>6.1.1一级缓存</h3><p>​    一级缓存只是相对于同一个SqlSession而言的。使用SqlSession第一次查询后，MyBatis会将其放在缓存中，以后再查询时，如果没有声明需要刷新，且缓存未超时的情况下，SqlSession都只会取出当前缓存的数据，而不会再次发送Sql到数据库。</p>
<h3 id="6-1-2二级缓存"><a href="#6-1-2二级缓存" class="headerlink" title="6.1.2二级缓存"></a>6.1.2二级缓存</h3><p>​    二级缓存是在SqlSessionFactory层面上的，可以将缓存提供给各个SqlSession对象共享。</p>
<h6 id="开启二级缓存配置"><a href="#开启二级缓存配置" class="headerlink" title="开启二级缓存配置"></a>开启二级缓存配置</h6><h6 id="mybatis-confi-xml文件中-默认开启，可忽略"><a href="#mybatis-confi-xml文件中-默认开启，可忽略" class="headerlink" title="mybatis-confi.xml文件中(默认开启，可忽略)"></a>mybatis-confi.xml文件中(默认开启，可忽略)</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!-- 二级缓存配置(默认开启,此行可省略) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="Mapper-xml文件中"><a href="#Mapper-xml文件中" class="headerlink" title="Mapper.xml文件中"></a>Mapper.xml文件中</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.dintalk.dao.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>/&gt;</span>  <span class="comment">&lt;!-- 开启二级缓存，使用默认配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用默认配置意味着：</span></span><br><span class="line"><span class="comment">映射语句文件中的所有select语句将会被缓存。</span></span><br><span class="line"><span class="comment">映射语句文件中的所有insert、update和delete语句会刷新缓存。</span></span><br><span class="line"><span class="comment">缓存使用默认的Least Recently Used(LRU，最近最少使用的)回收策略。</span></span><br><span class="line"><span class="comment">缓存会存1024个列表集合或对象（无论查询方法返回什么）</span></span><br><span class="line"><span class="comment">缓存会被视为是read/write（可读可写）的缓存</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong> </p>
<ul>
<li>一级缓存中存放的是对象本身，是同一个对象！</li>
<li>二级缓存中存放的是对象的拷贝，对象所属类必须实现jav.io.Serializable接口!</li>
</ul>
<h6 id="配置缓存"><a href="#配置缓存" class="headerlink" title="配置缓存"></a>配置缓存</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span>  <span class="attr">evicition</span>=<span class="string">"LRU"</span> <span class="attr">flushInterval</span>=<span class="string">"100000"</span> <span class="attr">size</span>=<span class="string">"1024"</span> <span class="attr">readOnly</span>=<span class="string">true/</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>eviction: 代表的是缓存回收策略，目前MyBatis提供以下策略：</p>
<p>​    （1）LRU, 最近最少使用的，移除最长时间不用的对象。</p>
<p>​    （2）FIFO, 先进先出，按对象进入缓存的顺序来移除它们。</p>
<p>​    （3）SOFT,软引用，移除基于垃圾回收器状态和软引用规则的对象。</p>
<p>​    （4）WEAK,弱引用，更积极地移除基于垃圾收集器状态和弱引用规则的对象。</p>
</li>
<li><p>flushInterval: 刷新间隔时间，单位为毫秒。</p>
</li>
<li><p>size: 引用数目，代表缓存最多可以存储多少个对象。</p>
</li>
<li><p>readOnly: 只读，意味着缓存数据只读。</p>
</li>
</ul>
<h2 id="6-2自定义缓存"><a href="#6-2自定义缓存" class="headerlink" title="6.2自定义缓存"></a>6.2自定义缓存</h2><p>​    系统缓存是MyBatis应用机器上的本地缓存，我们也可以使用缓存服务器来定制缓存，如比较流行的Redis缓存。我们需要实现MyBatis为我们提供的接口org.apache.ibatis.cache.Cache,缓存接口简介：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取缓存编号</span></span><br><span class="line"><span class="function">String <span class="title">getId</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//保存key值缓存对象</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">putObject</span><span class="params">(Object key,Object value)</span></span>;</span><br><span class="line"><span class="comment">//通过key获取缓存对象</span></span><br><span class="line"><span class="function">Object <span class="title">getObject</span><span class="params">(Object key)</span></span>;</span><br><span class="line"><span class="comment">//通过key删除缓存对象</span></span><br><span class="line"><span class="function">Object <span class="title">removeObject</span><span class="params">(Object key)</span></span>;</span><br><span class="line"><span class="comment">//清空缓存</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//获取缓存对象大小</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//获取缓存的读写锁</span></span><br><span class="line"><span class="function">ReadWriterLock <span class="title">getReadWriterLock</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>由于每种缓存都有其不同的特点，上面的接口都需要我们去实现。假设我们已经有一个实现类：cn.dintalk.MyCache。则配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">"cn.dintalk.MyCache"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>完成上述配置，就能使用自定义的缓存了。MyBatis也支持在缓存中定义常用的属性，如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">"cn.dintalk.MyCache"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"localhost"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们在MyCache这个类中增加setHost(String host) 方法,那么它在初始化的时候就会被调用，这样我们可以对自定义的缓存设置一些外部参数。</p>
<p><strong>Tips:</strong>  我们也可配置Sql层面的缓存规则，来决定它们是否需要刷新或使用缓存。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">...flushCache</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">...flushCache</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">...flushCache</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">...flushCache</span>=<span class="string">"false"</span> <span class="attr">useCache</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="7-附录-MyBatis常用配置及开发Tips"><a href="#7-附录-MyBatis常用配置及开发Tips" class="headerlink" title="7.附录-MyBatis常用配置及开发Tips"></a>7.附录-MyBatis常用配置及开发Tips</h1><h3 id="附录1：mybatis-config-xml常用配置"><a href="#附录1：mybatis-config-xml常用配置" class="headerlink" title="附录1：mybatis-config.xml常用配置"></a>附录1：mybatis-config.xml常用配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.引入外部的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"jdbc.properties"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2.配置延迟加载,即sql优化 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 启用懒加载策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 覆盖掉延迟加载的触发方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级缓存配置(默认开启,此行可省略) --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用二级缓存,在对应的mapper.xml中加入cache即可 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;setting name="cacheEnabled" value="true"/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 3.类别名的配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 单个类的配置 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;typeAlias type="cn.dintalk.domain.User" alias="user"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置druid数据源工厂类别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">"cn.dintalk.dataSource.DataSourceFactory"</span> <span class="attr">alias</span>=<span class="string">"DRUID"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 给包中所有的类配置默认别名, 即类名首字母小写--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.dintalk.domain"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 4.使用默认的环境配置(可以是多个) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"mysql"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 事务管理器,此处配置 为JDBC --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据源配置,此处配置为 POOLED--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;dataSource  type="POOLED"&gt;--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置druid数据源 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span>  <span class="attr">type</span>=<span class="string">"DRUID"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 配置数据库连接：name由数据源中的setXXX而定，value是外部配置的key --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driver&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 5.注册映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定资源文件路径 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="cn/dintalk/dao/UserMapper.xml"&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper resource="cn/dintalk/dao/LoginInfoMapper.xml"&gt;&lt;/mapper&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 基于Mapper接口的开发:指定类名--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapper class="cn.dintalk.dao.UserMapper"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定基于Mapper接口开发的包:(需类名和xml文件名一致,包名一致)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.dintalk.dao"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="附录2：Mapper-xml头约束"><a href="#附录2：Mapper-xml头约束" class="headerlink" title="附录2：Mapper.xml头约束"></a>附录2：Mapper.xml头约束</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.dintalk.dao.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span>/&gt;</span> <span class="comment">&lt;!-- 开启二级缓存 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>










      

       <!-- 添加版权声明 -->
    

  <div class="declare">
    <strong>本文作者：</strong>
    
      Sunny 宋
    
    <br>
    <strong>本文链接：</strong>
    <a href="http://songhui.club/数据库/2020/mybatis-known.html" title="MyBatis -- 必知必会" target="_blank">http://songhui.club/数据库/2020/mybatis-known.html</a>
    <br>
    <strong>版权声明：</strong>
    本作品采用
    <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    进行许可。转载请注明出处！
    
      <br>
      <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a>
    
  </div>

      <!-- 添加版权声明 -->

      <!-- 打赏 -->
      
        <div id="reward-btn">
          打赏
        </div>
        
    </div>
    <footer class="article-footer">
      <a data-url="http://songhui.club/%E6%95%B0%E6%8D%AE%E5%BA%93/2020/mybatis-known.html" data-id="ck5w6eh8o001uuo75bsch83d6"
        class="article-share-link">分享</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/source/tags/MyBatis/" rel="tag">MyBatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/source/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>

    </footer>

  </div>

  
  
  <nav class="article-nav">
    
      <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2020/MyBatis-generate.html" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            MyBatis的逆向工程
          
        </div>
      </a>
    
    
      <a href="/%E6%95%B0%E6%8D%AE%E5%BA%93/2020/jdbc-template.html" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">JdbcTemplate:(Jdbc模板)</div>
      </a>
    
  </nav>


  

  
  
<!-- valine评论 -->
<div id="vcomments-box">
    <div id="vcomments">
    </div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#vcomments',
        notify: false,
        verify: false,
        app_id: 'To3Gl7KkEp8hH5GysSMcKLqm-gzGzoHsz',
        app_key: 'JqEmtmoB3PhzQrnq3HyYTV4k',
        path: window.location.pathname,
        avatar: 'mp',
        placeholder: '给我的文章加点评论吧~',
        recordIP: true
    });
    const infoEle = document.querySelector('#vcomments .info');
    if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
        infoEle.childNodes.forEach(function (item) {
            item.parentNode.removeChild(item);
        });
    }
</script>
<style>
    #vcomments-box {
        padding: 5px 30px;
    }

    @media screen and (max-width: 800px) {
        #vcomments-box {
            padding: 5px 0px;
        }
    }

    #vcomments-box #vcomments {
        background-color: #fff;
    }

    .v .vlist .vcard .vh {
        padding-right: 20px;
    }

    .v .vlist .vcard {
        padding-left: 10px;
    }
</style>

  

  
  
  

</article>
</section>
      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2020
        Sunny 宋
      </li>
      <li>
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
        
        <ul class="list-inline">
  <li>PV:<span id="busuanzi_value_page_pv"></span></li>
  <li>UV:<span id="busuanzi_value_site_uv"></span></li>
</ul>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src=''></script>
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    
    <aside class="sidebar">
      
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/logo2.png" alt="Sunny SongHui"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">目录</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about/me.html">关于我</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="https://www.cnblogs.com/dintalk/" target="_blank" rel="noopener">博客园</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>


<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">



#上面是 yilia 主题配置自带 下面是我自己添加的js代码
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>


//这是自定一个js文件,放在 layout\_parial\post 目录 leancloud.ejs中
<script src="//cdn1.lncld.net/static/js/2.5.0/av-min.js"></script>
<script type="text/javascript"> 
if(true){
    var leancloud_app_id  = 'To3Gl7KkEp8hH5GysSMcKLqm-gzGzoHsz';
    var leancloud_app_key = 'JqEmtmoB3PhzQrnq3HyYTV4k';

    AV.init({
        appId: leancloud_app_id,
        appKey: leancloud_app_key
    });

    var pageViewsLength = $(".pageViews").length;

    var isIndex = $(".pageViews").length > 1 ?true:false;

    function showTime() {
        var Counter = AV.Object.extend("Counter");
        if(isIndex){
            $(".pageViews").each(function(){
                showPageViewsNum($(this),Counter);
                addPageViewsNum($(this));
            });
        }else{
            showPageViewsNum($(".pageViews"),Counter);
            addPageViewsNum($(".pageViews"));
        }
    }

    //显示阅读量
    function showPageViewsNum(ele,Counter){
        var query = new AV.Query("Counter");
        var url = ele.attr('id').trim();
            query.equalTo("words", url);
            query.count().then(function (number) {
                $(document.getElementById(url)).text(number?  number : '0');
            }, function (error) {
                 $(document.getElementById(url)).text('0');
            });
    }

    //追加阅读量
    function addPageViewsNum(ele){
        var url = ele.attr('id').trim();
        var Counter = AV.Object.extend("Counter");
        var query = new Counter;
        query.save({
            words: url
        }).then(function (object) {});
    }

    if(pageViewsLength){ //此处判断等于 1 在执行 可去除循环
        showTime();
    }
}
</script> 


#下面是 yilia 主题配置自带

<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  
  
  </div>
  <!-- 代码块复制功能 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script>
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<!-- <script type="text/javascript" src="/js/clipboard.js"></script>  -->
<script type="text/javascript" src="/js/clipboard_use.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"superSample":2,"width":300,"height":600,"position":"left","hOffset":0,"vOffset":-20},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
</html>